function addEvtListener(e,t,c){document.addEventListener?e?e.addEventListener(t,c,!1):addEventListener(t,c,!1):attachEvent&&(e?e.attachEvent("on"+t,c):attachEvent("on"+t,c))}function showClickHeatDebug(e){clickHeatDebug===!0&&(document.getElementById("clickHeatDebuggerSpan").innerHTML=e,document.getElementById("clickHeatDebuggerDiv").style.display="block")}function catchClickHeat(e){var t,c,i,a,r,o,l,n,s,u,H,d,g,m=[],h=!1,p=!1;try{if(showClickHeatDebug("Gathering click data..."),0===clickHeatQuota)return showClickHeatDebug("Click not logged: quota reached"),!0;if(""===clickHeatGroup)return showClickHeatDebug("Click not logged: group name empty (clickHeatGroup)"),!0;if(e||(e=window.event),t=e.which||e.button,c=e.srcElement||null,0===t)return showClickHeatDebug("Click not logged: no button pressed"),!0;if(null!==c&&"iframe"===c.tagName.toLowerCase()){if(c.sourceIndex===clickHeatLastIframe)return showClickHeatDebug("Click not logged: same iframe (a click on iframe opens a popup and popup is closed => iframe gets the focus again)"),!0;clickHeatLastIframe=c.sourceIndex}else clickHeatLastIframe=-1;if(i=e.clientX,a=e.clientY,r=clickHeatDocument.clientWidth||window.innerWidth,o=clickHeatDocument.clientHeight||window.innerHeight,"function"==typeof calculateScroll){var b=calculateScroll();s=b.scrollx,u=b.scrolly}else s=window.pageXOffset||clickHeatDocument.scrollLeft,u=window.pageYOffset||clickHeatDocument.scrollTop;if(l=Math.max(clickHeatDocument.scrollWidth,clickHeatDocument.offsetWidth,r),n=Math.max(clickHeatDocument.scrollHeight,clickHeatDocument.offsetHeight,o),i>r||a>o)return showClickHeatDebug("Click not logged: out of document (should be a click on scrollbars)"),!0;if(i+=s,a+=u,0>i||0>a||i>l||a>n)return showClickHeatDebug("Click not logged: out of document (should be a click out of the document's body)"),!0;if(H=new Date,H.getTime()-clickHeatTime<1e3)return showClickHeatDebug("Click not logged: at least 1 second between clicks"),!0;clickHeatTime=H.getTime(),clickHeatQuota>0&&(clickHeatQuota-=1);var f={s:clickHeatSite,g:clickHeatGroup,h:clickHeatHash,x:i,y:a,w:r,b:clickHeatBrowser,c:t,random:Date()};for(k in f)f.hasOwnProperty(k)&&f[k]&&m.push(encodeURIComponent(k)+"="+encodeURIComponent(f[k]));if(m=m.join("&"),showClickHeatDebug("Ready to send click data..."),0!==clickHeatServer.indexOf("http")){try{p=new ActiveXObject("Msxml2.XMLHTTP")}catch(w){try{p=new ActiveXObject("Microsoft.XMLHTTP")}catch(v){p=null}}p||"undefined"==typeof XMLHttpRequest||(p=new XMLHttpRequest),p&&(clickHeatDebug===!0&&(p.onreadystatechange=function(){4===p.readyState&&(showClickHeatDebug(200===p.status?"Click recorded at "+clickHeatServer+" with the following parameters:<br/>x = "+i+" ("+(i-s)+"px from left + "+s+"px of horizontal scrolling, max width = "+l+")<br/>y = "+a+" ("+(a-u)+"px from top + "+u+"px of vertical scrolling, max height = "+n+")<br/>width = "+r+"<br/>browser = "+clickHeatBrowser+"<br/>click = "+t+"<br/>site = "+clickHeatSite+"<br/>group = "+clickHeatGroup+"<br/><br/>Server answer: "+p.responseText:404===p.status?"click.php was not found at: "+(""!==clickHeatServer?clickHeatServer:"/clickheat/click.php")+" please set clickHeatServer value":"click.php returned a status code "+p.status+" with the following error: "+p.responseText),clickHeatLocalWait=0)}),p.open("GET",clickHeatServer+"?"+m,!0),p.send(null),h=!0)}for(h===!1&&(clickHeatDebug===!0?showClickHeatDebug("Click recorded at "+clickHeatServer+" with the following parameters:<br/>x = "+(i+s)+" ("+i+"px from left + "+s+"px of horizontal scrolling)<br/>y = "+(a+u)+" ("+a+"px from top + "+u+"px of vertical scrolling)<br/>width = "+r+"<br/>browser = "+clickHeatBrowser+"<br/>click = "+t+"<br/>site = "+clickHeatSite+"<br/>group = "+clickHeatGroup+'<br/><br/>Server answer:<br/><iframe src="'+clickHeatServer+"?"+m+'" width="700" height="60"></iframe>'):(g=new Image,g.src=clickHeatServer+"?"+m)),d=new Date,clickHeatLocalWait=d.getTime()+clickHeatWait;clickHeatLocalWait>d.getTime();)d=new Date}catch(D){showClickHeatDebug("An error occurred while processing click (Javascript error): "+D.message)}return!0}function initClickHeat(){var e,t,c,i,a,r;if(clickHeatDebug===!0&&(r=document.createElement("div"),r.id="clickHeatDebuggerDiv",r.style.padding="5px",r.style.display="none",r.style.position="absolute",r.style.top="200px",r.style.left="200px",r.style.border="1px solid #888",r.style.backgroundColor="#eee",r.style.color="#a00",r.style.zIndex=99,r.innerHTML='<a href="#" onmouseover="document.getElementById(\'clickHeatDebuggerDiv\').style.display = \'none\'; return false" style="float:right">Rollover to close</a><strong>ClickHeat debug:</strong><br/><br/><span id="clickHeatDebuggerSpan"></span>',document.body.appendChild(r)),""===clickHeatGroup||""===clickHeatServer)return showClickHeatDebug("ClickHeat NOT initialised: either clickHeatGroup or clickHeatServer is empty"),!1;for(a=document.location.protocol+"//"+document.location.host,0===clickHeatServer.indexOf(a)&&(clickHeatServer=clickHeatServer.substring(a.length,clickHeatServer.length)),addEvtListener(document,"mousedown",catchClickHeat),t=document.getElementsByTagName("iframe"),e=0;e<t.length;e+=1)addEvtListener(t[e],"focus",catchClickHeat);for(clickHeatDocument=document.documentElement&&0!==document.documentElement.clientHeight?document.documentElement:document.body,c=navigator.userAgent?navigator.userAgent.toLowerCase().replace(/-/g,""):"",i=["chrome","firefox","safari","msie","opera"],clickHeatBrowser="unknown",e=0;e<i.length;e+=1)if(-1!==c.indexOf(i[e])){clickHeatBrowser=i[e];break}showClickHeatDebug("ClickHeat initialised with:<br/>site = "+clickHeatSite+"<br/>group = "+clickHeatGroup+"<br/>server = "+clickHeatServer+"<br/>quota = "+(-1===clickHeatQuota?"unlimited":clickHeatQuota)+"<br/>browser = "+clickHeatBrowser+"<br/><br/><strong>Click in a blank area (not on a link) to test ClickHeat</strong>")}var clickHeatGroup="",clickHeatSite="",clickHeatServer="",clickHeatLastIframe=-1,clickHeatTime=0,clickHeatQuota=-1,clickHeatBrowser="",clickHeatDocument="",clickHeatWait=500,clickHeatLocalWait=0,clickHeatDebug=-1!==document.location.href.indexOf("debugclickheat");
